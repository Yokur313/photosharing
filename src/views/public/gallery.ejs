<section class="card">
  <div class="row" style="justify-content:space-between;align-items:center">
    <div>
      <div class="muted" style="font-size:12px;line-height:1">Shared Folder</div>
      <h2 style="margin:6px 0 0 0"><%= share.folderKey %></h2>
    </div>
    <div class="row">
      <form id="selected-download" method="get" action="/s/<%= share.id %>/download.zip" style="display:inline-flex;gap:8px;align-items:center">
        <input type="hidden" name="keys" id="selected-keys" value="" />
        <button type="submit" class="secondary" id="download-selected" disabled>Download selected</button>
      </form>
      <button id="download-all" class="secondary" type="button" onclick="location.href='/s/<%= share.id %>/download.zip'">Download all</button>
    </div>
  </div>
  <p class="muted"><%= share.folderKey %></p>
  <div class="grid">
    <% items.forEach(item => { %>
      <label class="tile" style="position:relative;cursor:pointer">
        <input type="checkbox" class="sel" value="<%= item.key %>" style="z-index:2">
        <a href="<%= item.url %>" target="_blank" style="text-decoration:none;color:inherit">
          <div class="thumb">
            <img src="/s/<%= share.id %>/thumb?key=<%= encodeURIComponent(item.key || item.url) %>&w=256&h=256" alt="<%= item.name %>" loading="lazy" />
          </div>
        </a>
      </label>
    <% }) %>
  </div>
  <% if (share.editable) { %>
  <hr />
  <form class="row" method="post" action="/s/<%= share.id %>/upload" enctype="multipart/form-data">
    <input type="file" name="photos" multiple accept="image/*" />
    <button type="submit">Add photos</button>
  </form>
  <% } %>
</section>

<script>
(function(){
  const form = document.getElementById('selected-download');
  if (!form) return;
  const btn = document.getElementById('download-selected');
  const hidden = document.getElementById('selected-keys');
  function update(){
    const sel = Array.from(document.querySelectorAll('input.sel:checked')).map(i => i.value);
    btn.disabled = sel.length === 0;
    btn.textContent = sel.length ? `Download selected (${sel.length})` : 'Download selected';
    hidden.value = sel.join(',');
  }
  document.querySelectorAll('input.sel').forEach(cb => cb.addEventListener('change', update));
  form.addEventListener('submit', (e) => {
    const vals = hidden.value ? hidden.value.split(',').filter(Boolean) : [];
    if (vals.length === 0) { e.preventDefault(); return; }
    const q = new URLSearchParams();
    vals.forEach(v => q.append('keys[]', v));
    window.location.href = `${form.action}?${q.toString()}`;
    e.preventDefault();
  });
})();
</script>


